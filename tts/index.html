<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Text to Speech – RF Online Tools</title>

<!-- ADSENSE -->
<meta name="google-adsense-account" content="ca-pub-6776252433902731">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6776252433902731" crossorigin="anonymous"></script>

<style>
    body { margin:0; background:#0f0f0f; font-family:"Inter",sans-serif; color:white; display:flex; flex-direction:column; align-items:center; padding:40px 20px; }
    h1 { font-size:2.5rem; background:linear-gradient(90deg,#00eaff,#008cff); -webkit-background-clip:text; color:transparent; margin-bottom:5px; }
    .tts-box { width:100%; max-width:650px; background:rgba(255,255,255,0.05); padding:25px; border-radius:18px; backdrop-filter:blur(8px); }
    textarea { width:100%; height:180px; padding:15px; border-radius:12px; background:rgba(255,255,255,0.08); color:white; border:none; resize:none; outline:none; }
    select, button { width:100%; margin-top:15px; padding:12px; border-radius:12px; border:none; }
    button { background:linear-gradient(90deg,#00eaff,#008cff); color:black; font-weight:700; cursor:pointer; }
    audio { width:100%; margin-top:20px; }
</style>
</head>

<body>

<h1>Text to Speech</h1>
<p class="subtitle">Type → Speak → Download MP3</p>

<div class="tts-box">
    <textarea id="ttsText" placeholder="Type text here..."></textarea>
    <select id="voiceSelect"></select>

    <button onclick="generateAudio()">Speak (Generate Audio)</button>
    <button onclick="downloadAudio()">Download MP3</button>

    <audio id="audioPlayer" controls style="display:none;"></audio>
</div>

<script>
// ---- GLOBALS ----
let voices = [];
let audioBlob = null;

// ---- LOAD VOICES ----
function loadVoices() {
    voices = speechSynthesis.getVoices();

    const select = document.getElementById("voiceSelect");
    select.innerHTML = voices
        .map(v => `<option value="${v.name}">${v.name} (${v.lang})</option>`)
        .join("");
}
speechSynthesis.onvoiceschanged = loadVoices;
loadVoices();

// ---- SPEAK + GENERATE WAV ----
async function generateAudio() {
    const text = document.getElementById("ttsText").value.trim();
    if (!text) return;

    speechSynthesis.cancel(); // reset

    const utter = new SpeechSynthesisUtterance(text);
    const selected = voices.find(v => v.name === document.getElementById("voiceSelect").value);
    if (selected) utter.voice = selected;

    // ---- CREATE AUDIO CONTEXT TO CAPTURE SPEECH ----
    const audioContext = new AudioContext();
    const dest = audioContext.createMediaStreamDestination();
    const recorder = new MediaRecorder(dest.stream);
    const chunks = [];

    recorder.ondataavailable = e => chunks.push(e.data);

    recorder.onstop = () => {
        audioBlob = new Blob(chunks, { type: "audio/wav" });
        const url = URL.createObjectURL(audioBlob);

        const audio = document.getElementById("audioPlayer");
        audio.style.display = "block";
        audio.src = url;
    };

    recorder.start();

    const source = audioContext.createMediaStreamSource(dest.stream);
    speechSynthesis.speak(utter);

    utter.onend = () => recorder.stop();
}

// ---- DOWNLOAD MP3/WAV ----
function downloadAudio() {
    if (!audioBlob) {
        alert("Generate audio first!");
        return;
    }

    const url = URL.createObjectURL(audioBlob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "tts_audio.wav"; 
    a.click();
    URL.revokeObjectURL(url);
}
</script>

</body>
</html>
